<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/basic.css">
    <link rel="stylesheet" href="css/ad_number.css">
</head>
<body>
<div class="big-box">
    <div class="header_img">全国终端数据展示</div>

    <div class="content box_flex">
        <div class="left-box">
            <div class="left-top" id="top_play_auto"></div>
            <div class="left-middle" id="top_display_position"></div>
            <div class="left-bottom" id="aa"></div>
        </div>
        <div class="center-box">
            <div class="center-top">
                <div class="history-text">历史广告曝光频次</div>
                <div class="this-year">本年曝光频次</div>
                <div class="data-box">
                    <div class="history-data">242423</div>
                    <div class="this-year-data">12323</div>
                </div>
                <div class="current">
                    <div class="current-month">
                        <div>本月</div>
                        <div>275634</div>
                    </div>
                    <div class="current-week">
                        <div>W41</div>
                        <div>21312</div>
                    </div>
                    <div class="current-day">
                        <div>当日</div>
                        <div>2754</div>
                    </div>
                </div>
            </div>
            <div class="center-middle" id="china_map"></div>
            <div class="center-bottom">
                <div class="room-num">
                    <div>房间数</div>
                    <div>1212434</div>
                </div>
                <div class="hotel-num">
                    <div>酒店数</div>
                    <div>43565464</div>
                </div>
            </div>
        </div>
        <div class="right-box">
            <div class="right-top" id="bb"></div>
            <div class="right-middle" id="cc"></div>
            <div class="right-bottom" id="top_play_act"></div>
        </div>
    </div>

</div>


<script src="js/jquery.js"></script>
<script src="js/common.js"></script>
<script src="js/echarts.min.js"></script>
<script src="js/echarts-gl.min.js"></script>
<script src="js/china.js"></script>
<script>
    var adNumber = {
        fontSizeNum : 18,
        init:function () {
            this.windowOnload();
            //除地图外的echart图数据，接口get_charts_advs
            this.createEchart();
            //热力图展示，接口advKanbanHeatData
            this.chinaMapShow();
            // // 广告曝光频次
            // this.avdPersonsNumShow();
        },
        windowOnload:function () {
            var that = this;
            setRemSize();
            $(window).resize(function () {          //当浏览器大小变化时
                setRemSize();
                location.reload();
            });
            function setRemSize(){
                that.fontSizeNum=document.documentElement.clientWidth/1920 * 100;
                //将得到的rem值复制给根元素的font-size
                document.documentElement.style.fontSize=that.fontSizeNum+"px";
            }
        },
        createEchart :function () {
            var that = this;
            $.post(GPATH.getChartsAdvs, function(data){
                if(data.res){
                    var content = data.data;
                    for(var i=0;i<content.length;i++){
                        var item = content[i];
                        var chart_type = item['chart_type'];
                        var domID = item['title_value'];
                        if(chart_type == 'bar'){
                            if(domID =="top_play_auto"){
                                item['value'] = item['value'].reverse();
                                var color =["#3DE7C9","rgba(61,231,201,0.1)"];
                                var bgData = that.bgData(item['value']);
                                var option = options.barChart(color,item['label'],bgData,item['value'],that.fontSizeNum);
                                option.title.text = "月度主流广告产品播放频次";
                                var echartObj = new EchartObj(domID,option);
                                echartObj.setOp();

                                var color =["#3DE7C9","#3DE7C9"];
                                var bgData = that.bgData(item['value']);
                                var option = options.barChart(color,item['label'],bgData,item['value'],that.fontSizeNum);
                                option.title.text = "月度主流广告产品播放频次";
                                var echartObj = new EchartObj("aa",option);
                                echartObj.setOp();

                                var color =["#3DE7C9","rgba(61,231,201,0.1)"];
                                var bgData = that.bgData(item['value']);
                                var option = options.barChart(color,item['label'],bgData,item['value'],that.fontSizeNum);
                                option.title.text = "月度主流广告产品播放频次";
                                var echartObj = new EchartObj("bb",option);
                                echartObj.setOp();

                                var color =["#3DE7C9","rgba(61,231,201,0.1)"];
                                var bgData = that.bgData(item['value']);
                                var option = options.barChart(color,item['label'],bgData,item['value'],that.fontSizeNum);
                                option.title.text = "月度主流广告产品播放频次";
                                var echartObj = new EchartObj("cc",option);
                                echartObj.setOp();
                            }else if(domID =="top_play_act"){
                                var color =["rgba(67,85,255,1)","rgba(67,85,255,.1)"];
                                var option = options.normalBarChart(color,item['label'],item['value'],that.fontSizeNum);
                                option.title.text = "开房浓度地区分布 TOP5";
                                var echartObj = new EchartObj(domID,option);
                                echartObj.setOp();
                            }else if(domID=="top_display_position"){
                                var color =["#00A8B9","rgba(0,168,185,.1)"];
                                var option = options.normalBarChart(color,item['label'],item['value'],that.fontSizeNum);
                                option.title.text = "月度主流广告产品播放频次";
                                var echartObj = new EchartObj(domID,option);
                                echartObj.setOp();
                            }
                        }else{
                            var color =["#DCAF10","rgba(224,176,5,.6)","rgba(224,176,5,.1)"];
                            var option = options.lineChart(color,item['label'],item['value'],that.fontSizeNum);
                            var echartObj = new EchartObj(domID,option);
                            echartObj.setOp();
                        }

                        // var echartObj = new EchartObj(domID,option);
                        // echartObj.setOp();
                    }
                }
            },"json");
            setInterval(function () {
                $historyText = $(".history-text");
                $thisYear = $(".this-year");
                $historyData = $(".history-data");
                $thisYearData = $(".this-year-data");

                var a =  $historyText.css("transform");
                var b = a.slice(9,10);
                var arr = ["历史广告曝光频次","本年"]
                    if(b=="1"){
                    console.log(11)
                        // $historyText.html(arr[0]);
                        // $thisYear.html(arr[1]);
                        $historyText.removeClass("flipIn");
                        $thisYear.removeClass("flipOut");
                        $historyText.addClass("flipOut");
                        $thisYear.addClass('flipIn');

                        $historyData.removeClass("flipIn");
                        $thisYearData.removeClass("flipOut");
                        $historyData.addClass("flipOut");
                        $thisYearData.addClass('flipIn');
                    }else{
                        console.log(22)
                        // $historyText.html(arr[0]);
                        // $thisYear .html(arr[1]);
                        $historyText.removeClass("flipOut");
                        $thisYear.removeClass("flipIn");
                        $historyText.addClass("flipIn");
                        $thisYear.addClass('flipOut');

                        $historyData.removeClass("flipOut");
                        $thisYearData.removeClass("flipIn");
                        $thisYearData.addClass("flipOut");
                        $historyData.addClass('flipIn');
                    }
            }, 3000);
        },
        avdPersonsNumShow:function(){
            var fixedTotal = parseInt($('#fixed_total').val());
            var fixedMonth = parseInt($('#fixed_month').val());
            var fixedWeek = parseInt($('#fixed_week').val());
            var fixedPersons = parseInt($('#fixedPersons').val());
            queryNumPersons(fixedPersons);
            queryNumAdvs(fixedTotal,fixedMonth,fixedWeek);
            setInterval(function(){
                queryNumPersons(fixedPersons);
                queryNumAdvs(fixedTotal,fixedMonth,fixedWeek);
            },1000*10);
            function queryNumPersons(fixedPersons){
                $.post(GPATH.advTodayPersonsData,{},function(data){
                    if(data.res){
                        var tpnum = parseInt(data.msg);
                        $('#personNumBox').html(toThousands(fixedPersons+tpnum));
                    }
                },"json");
            }
            function queryNumAdvs(fixedTotal,fixedMonth,fixedWeek){
                $.post(GPATH.advTodayAdvsData,{},function(data){
                    if(data.res){
                        var numToday = parseInt(data.msg);
                        if(numToday > 0){
                            $("#todayNumCounter").html(toThousands(numToday));
                            $("#totalNumCounter").html(toThousands(fixedTotal+numToday));
                            $("#monthNumCounter").html(toThousands(fixedMonth+numToday));
                            $("#weekNumCounter").html(toThousands(fixedWeek+numToday));
                        }
                    }
                },"json");
            }
            // 数字格式化
            function toThousands(num) {
                var num = (num || 0).toString(), result = '';
                while (num.length > 3) {
                    result = ',' + num.slice(-3) + result;
                    num = num.slice(0, num.length - 3);
                }
                if (num) { result = num + result; }
                return result;
            }
            //数字动态
            function num_counter(domID){
                var decimal_places = 1;
                var decimal_factor = decimal_places === 0 ? 1 : decimal_places * 10;
                $(domID).animateNumber(
                    {
                        number: 100 * decimal_factor,
                        color: 'green',
                        'font-size': '30px',

                        numberStep: function(now, tween) {
                            var floored_number = Math.floor(now) / decimal_factor,
                                target = $(tween.elem);
                            if (decimal_places > 0) {
                                floored_number = floored_number.toFixed(decimal_places);
                            }

                            target.text(floored_number + ' %');
                        }
                    },
                    15000
                )
            }
        },
        chinaMapShow:function () {
            var that = this;
            $.post(GPATH.advKanbanHeatData,function(data){
                if(data.res){
                    var heatBox = data.msg;
                    var option= options.heatMapChart(heatBox,that.fontSizeNum);
                    var domID = "china_map";
                    var echartObj = new EchartObj(domID,option);
                    echartObj.setOp();
                }
            },"json");
        },

        //柱状图背景色数据函数
        bgData:function (data) {
            var max = 0,bgData = [];
            data.forEach(item => {
                if (max < item) max = item;
            })
            data.forEach(item => {
                bgData.push(max)
            })
            return bgData;
        }
    }
    $(function() {
        adNumber.init();
    });
</script>
   
</body>
</html>